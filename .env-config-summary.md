# ğŸ”§ Environment Configuration Added

## âœ… What Changed

Your UI Hybrid Regression Checker now supports **configurable settings via .env file**!

### New Environment Variables

1. **`KEEP_RUNS_COUNT`** (Default: `5`)
   - Controls how many daily screenshot runs to keep
   - Older runs are automatically cleaned up
   - Example: Set to `10` to keep 10 days of history

2. **`PIXEL_DIFF_THRESHOLD`** (Default: `2.0`)
   - Pixel difference percentage for marking errors
   - Pages exceeding this threshold = âŒ Error
   - Lower = more sensitive, Higher = more lenient

---

## ğŸ“ Files Modified

### 1. `.env` - Your Configuration File
```bash
# New settings added:
KEEP_RUNS_COUNT = "5"
PIXEL_DIFF_THRESHOLD = "2.0"
```

### 2. `.env.example` - Template/Documentation
Created with full documentation and examples

### 3. `utils/envFile.ts` - Environment Variable Loader
```typescript
// Added exports:
export const keepRunsCount = parseInt(process.env.KEEP_RUNS_COUNT || '5');
export const pixelDiffThreshold = parseFloat(process.env.PIXEL_DIFF_THRESHOLD || '2.0');
```

### 4. `scripts/reports.ts` - Report Generator
- Imports env variables
- Uses `pixelDiffThreshold` for error determination
- Uses `keepRunsCount` for cleanup
- Shows count in console: `"Cleaning up old runs (keeping last 5)..."`

### 5. `README.md` - Documentation
- Added Configuration section
- Added table of environment variables
- Added examples for common use cases

---

## ğŸ¯ How to Use

### Quick Start (Use Defaults)
Just keep your `.env` as is:
```bash
KEEP_RUNS_COUNT = "5"
PIXEL_DIFF_THRESHOLD = "2.0"
```

### Custom Configuration

**Scenario 1: Keep More History**
```bash
# Keep last 10 days instead of 5
KEEP_RUNS_COUNT = "10"
```

**Scenario 2: More Lenient Comparison**
```bash
# Only mark as error if >5% pixels changed
PIXEL_DIFF_THRESHOLD = "5.0"
```

**Scenario 3: Strict Comparison**
```bash
# Mark as error if >0.5% pixels changed
PIXEL_DIFF_THRESHOLD = "0.5"
```

**Scenario 4: Development Mode**
```bash
# Keep lots of history, lenient comparison
KEEP_RUNS_COUNT = "20"
PIXEL_DIFF_THRESHOLD = "10.0"
```

**Scenario 5: Production Mode**
```bash
# Keep minimal history, strict comparison
KEEP_RUNS_COUNT = "3"
PIXEL_DIFF_THRESHOLD = "1.0"
```

---

## ğŸ§ª Testing the Configuration

### Test 1: Verify Current Settings
```bash
npm run report
```

Look for: `ğŸ§¹ Cleaning up old runs (keeping last 5)...`
The number shown is from your `KEEP_RUNS_COUNT` setting!

### Test 2: Change Settings
Edit `.env`:
```bash
KEEP_RUNS_COUNT = "10"
PIXEL_DIFF_THRESHOLD = "5.0"
```

Run report again:
```bash
npm run report
```

You'll see: `ğŸ§¹ Cleaning up old runs (keeping last 10)...`

### Test 3: Manual Cleanup
```bash
# Override with command line
npm run cleanup 15

# This keeps 15 runs, regardless of .env setting
```

---

## ğŸ“Š Default Behavior

| Setting | Default | What It Means |
|---------|---------|---------------|
| `KEEP_RUNS_COUNT = "5"` | Keeps 5 days | Last 5 daily runs preserved, older ones deleted |
| `PIXEL_DIFF_THRESHOLD = "2.0"` | 2% threshold | Pages with >2% pixel difference marked as âŒ Error |

### How Threshold Works

**Example Page: 1920x1080 = 2,073,600 pixels**

```bash
PIXEL_DIFF_THRESHOLD = "2.0"  # 2% = ~41,472 pixels
```

- 10,000 pixels different â†’ 0.48% â†’ âš ï¸ Warning
- 30,000 pixels different â†’ 1.45% â†’ âš ï¸ Warning  
- 50,000 pixels different â†’ 2.41% â†’ âŒ Error

```bash
PIXEL_DIFF_THRESHOLD = "5.0"  # 5% = ~103,680 pixels
```

- 50,000 pixels different â†’ 2.41% â†’ âš ï¸ Warning
- 100,000 pixels different â†’ 4.82% â†’ âš ï¸ Warning
- 110,000 pixels different â†’ 5.30% â†’ âŒ Error

---

## ğŸ¨ Customization Examples

### For CI/CD Pipeline
```bash
# Strict settings for automated checks
KEEP_RUNS_COUNT = "3"
PIXEL_DIFF_THRESHOLD = "1.0"
```

### For Development
```bash
# Lenient settings while making UI changes
KEEP_RUNS_COUNT = "15"
PIXEL_DIFF_THRESHOLD = "10.0"
```

### For Design QA
```bash
# Very strict for catching tiny visual changes
KEEP_RUNS_COUNT = "7"
PIXEL_DIFF_THRESHOLD = "0.5"
```

### For Monitoring Production
```bash
# Balanced settings for daily checks
KEEP_RUNS_COUNT = "5"
PIXEL_DIFF_THRESHOLD = "2.0"
```

---

## ğŸ” How It Works

### 1. Application Startup
```typescript
// envFile.ts loads .env
import dotenv from 'dotenv';
dotenv.config();

// Parse values with defaults
export const keepRunsCount = parseInt(process.env.KEEP_RUNS_COUNT || '5');
export const pixelDiffThreshold = parseFloat(process.env.PIXEL_DIFF_THRESHOLD || '2.0');
```

### 2. Report Generation
```typescript
// reports.ts uses the values
import { keepRunsCount, pixelDiffThreshold } from '../utils/envFile.js';

// Threshold check
const PIXEL_DIFF_THRESHOLD = pixelDiffThreshold;
if (diffPercent > PIXEL_DIFF_THRESHOLD) {
  status = 'âŒ Error';
}

// Cleanup
cleanupOldRuns(keepRunsCount);
```

### 3. Cleanup Process
```typescript
function cleanupOldRuns(keepCount = keepRunsCount) {
  console.log(`Cleaning up old runs (keeping last ${keepCount})...`);
  // Removes all but the last 'keepCount' runs
}
```

---

## ğŸ’¡ Tips

### Tip 1: Start with Defaults
The default values (5 runs, 2% threshold) work well for most cases.

### Tip 2: Adjust Gradually
If getting too many errors, increase threshold by 1% at a time:
```bash
2.0 â†’ 3.0 â†’ 4.0 â†’ 5.0
```

### Tip 3: Monitor Disk Space
More runs = more disk space:
- 5 runs â‰ˆ 50-100MB
- 10 runs â‰ˆ 100-200MB
- 20 runs â‰ˆ 200-400MB

### Tip 4: Different Environments
Create different `.env` files:
```bash
.env.development  # Lenient settings
.env.staging      # Moderate settings
.env.production   # Strict settings
```

Then copy the appropriate one:
```bash
cp .env.production .env
```

---

## ğŸ‰ Benefits

âœ… **No Code Changes**: Configure via `.env` file
âœ… **Safe Defaults**: Works great out of the box
âœ… **Flexible**: Adjust to your needs
âœ… **Per-Environment**: Different settings for dev/staging/prod
âœ… **Documented**: `.env.example` shows all options
âœ… **Type-Safe**: Values validated and parsed correctly

---

## ğŸ“š Reference

### Files to Check
- **`.env`** - Your actual configuration
- **`.env.example`** - Template with documentation
- **`README.md`** - User guide with examples
- **`utils/envFile.ts`** - Where variables are loaded
- **`scripts/reports.ts`** - Where variables are used

### Commands
```bash
# Run with current .env settings
npm test

# Generate report
npm run report

# Override cleanup count
npm run cleanup 10

# View available dates
npm run list-dates
```

---

## âœ¨ Summary

Your UI checker is now **fully configurable**!

- ğŸ”§ **Easy to configure** via `.env`
- ğŸ“ **Well documented** with examples
- ğŸ¯ **Smart defaults** that work for most cases
- ğŸ”„ **Flexible** for different environments
- ğŸš€ **Production ready** with no breaking changes

Just edit `.env` and run your tests! ğŸ‰
